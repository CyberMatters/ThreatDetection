Detection rule: Snake_Malware_-_Kernel_driver

Description: |
    This rule detects file activity that could be related to Snake malware dropping its kernel driver on the file system.
    According to CISA report :
    "Snake’s installer drops the kernel driver and a custom DLL which is used to load the driver into a single AES encrypted file on disk. 
    Typically, this file is named “comadmin.dat” and is stored in the %windows%\system32\Com directory."

    Action to perform:
    - Analyze the newly created file
    - Analyze the process lineage

    More info: https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-129a

Technique IDs: 
    - T1574.002
    - T1027

KQL query: |
    DeviceFileEvents
    | where FileName has "comadmin.dat"
    | where FolderPath startswith @"C:\Windows\System32\Com"