Detection rule: Snake_malware_-_Persistence_related_file

Description: |
    This rule detects file activity similar to those generated by Snake malware persistence mechanism.
    According to CISA report : 
    "The Snake version primarily discussed in this advisory registers a service to maintain persistence on\na system. 
    Typically, this service is named “WerFaultSvc” which we assess was used to blend in with the legitimate Windows service WerSvc.
    On boot, this service will execute Snake’s WerFault.exe, which Snake developers chose to hide among the numerous valid Windows “WerFault.exe” files in the %windows%\WinSxS\ directory.
    Executing WerFault.exe will start the process of decrypting\nSnake’s components and loading them into memory"

    Action to perform:
    - Analyze the file itself (known hash/signature/origin etc )
    - Analyze the process lineage

    More info: https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-129a

Technique IDs: 
    - T1569

KQL query: |
    DeviceFileEvents
    | where FileName has "werfault.exe"
    | where FolderPath startswith @"C:\Windows\WinSxS"