Detection rule: Snake_Malware_-_Encrypted_data_hidden_in_Windows_registries

Description: |
    This rule detects registry activities in a location that is used by Snale malware to hide an encryption key.
    According to CISA report :
    "Upon execution, Snake’s WerFault.exe will attempt to decrypt an encrypted blob within the Windows registry that is typically found at HKLM:\SOFTWARE\Classes.wav\OpenWithProgIds. 
    The encrypted data includes the AES key, IV, and path that is used to find and decrypt the file containing Snake’s kernel driver and kernel driver loader."

    Action to perform:
    - Analyze the process lineage

    More info: https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-129a

Technique IDs: 
    - T1112
    - T1106

KQL query: |
    DeviceRegistryEvents
    | where RegistryKey contains @"HKEY_LOCAL_MACHINE\SOFTWARE\Classes\.wav\OpenWithProgIds"